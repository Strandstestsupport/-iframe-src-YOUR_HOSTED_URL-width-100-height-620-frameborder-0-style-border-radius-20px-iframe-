<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strands AI Support</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #0a0a0a;
  --surface: #111111;
  --surface2: #1a1a1a;
  --border: #2a2a2a;
  --border2: #333333;
  --accent: #3b82f6;
  --accent-dark: #2563eb;
  --accent-glow: rgba(59,130,246,0.15);
  --text: #f0f0f0;
  --text2: #a0a0a0;
  --muted: #666;
  --bot-bg: #161616;
  --user-bg: #1d3a6e;
  --green: #22c55e;
  --red: #ef4444;
  --yellow: #f59e0b;
}

body {
  background: var(--bg); color: var(--text);
  font-family: 'Inter', sans-serif;
  min-height: 100vh; display: flex; flex-direction: column;
  align-items: center; justify-content: center; padding: 20px;
  background-image:
    radial-gradient(ellipse at 20% 50%, rgba(59,130,246,0.04) 0%, transparent 60%),
    radial-gradient(ellipse at 80% 10%, rgba(59,130,246,0.03) 0%, transparent 50%);
}

/* â”€â”€ SETUP MODAL â”€â”€ */
.setup-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.85);
  backdrop-filter: blur(8px); display: flex; align-items: center;
  justify-content: center; z-index: 1000; padding: 20px;
  animation: fadeIn 0.3s ease;
}
.setup-overlay.hidden { display: none; }

.setup-card {
  background: var(--surface); border: 1px solid var(--border2);
  border-radius: 20px; padding: 36px; max-width: 460px; width: 100%;
  box-shadow: 0 24px 80px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.04);
  animation: slideUp 0.4s ease;
}

.setup-logo {
  width: 52px; height: 52px; background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  border-radius: 14px; display: flex; align-items: center; justify-content: center;
  font-family: 'Syne', sans-serif; font-weight: 800; font-size: 13px; color: white;
  margin-bottom: 20px; box-shadow: 0 0 24px rgba(59,130,246,0.3);
  letter-spacing: -0.5px;
}

.setup-card h2 {
  font-family: 'Syne', sans-serif; font-size: 22px; font-weight: 700;
  color: var(--text); margin-bottom: 6px;
}

.setup-card p { font-size: 13.5px; color: var(--text2); line-height: 1.6; margin-bottom: 24px; }

.setup-card p a { color: var(--accent); text-decoration: none; }
.setup-card p a:hover { text-decoration: underline; }

.setup-label {
  font-size: 12px; font-weight: 600; color: var(--text2);
  text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; display: block;
}

.api-input-wrap { position: relative; margin-bottom: 16px; }
.api-input-wrap input {
  width: 100%; background: var(--surface2); border: 1px solid var(--border2);
  border-radius: 10px; padding: 11px 44px 11px 14px;
  color: var(--text); font-family: 'Inter', sans-serif; font-size: 14px;
  outline: none; transition: border-color 0.2s, box-shadow 0.2s;
}
.api-input-wrap input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
.api-input-wrap input::placeholder { color: var(--muted); }
.eye-btn {
  position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
  background: none; border: none; color: var(--muted); cursor: pointer;
  font-size: 16px; padding: 2px;
}
.eye-btn:hover { color: var(--text2); }

.api-hint {
  font-size: 12px; color: var(--muted); margin-bottom: 20px; line-height: 1.5;
}
.api-hint a { color: var(--accent); }

.model-select-wrap { margin-bottom: 20px; }
.model-select-wrap select {
  width: 100%; background: var(--surface2); border: 1px solid var(--border2);
  border-radius: 10px; padding: 11px 14px; color: var(--text);
  font-family: 'Inter', sans-serif; font-size: 14px; outline: none;
  cursor: pointer; transition: border-color 0.2s;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 14px center;
}
.model-select-wrap select:focus { border-color: var(--accent); }
.model-select-wrap select option { background: #1a1a1a; }

.start-btn {
  width: 100%; padding: 12px; background: linear-gradient(135deg, #3b82f6, #2563eb);
  border: none; border-radius: 10px; color: white;
  font-family: 'Inter', sans-serif; font-size: 15px; font-weight: 600;
  cursor: pointer; transition: all 0.2s;
  box-shadow: 0 4px 16px rgba(59,130,246,0.3);
}
.start-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(59,130,246,0.4); }
.start-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

.setup-error {
  background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);
  color: #fca5a5; border-radius: 8px; padding: 10px 14px;
  font-size: 13px; margin-top: 12px; display: none;
}

/* â”€â”€ APP SHELL â”€â”€ */
.wrapper { width: 100%; max-width: 780px; }

/* Top bar */
.topbar {
  display: flex; align-items: center; gap: 12px;
  margin-bottom: 20px; animation: fadeDown 0.5s ease both;
}

.logo-mark {
  width: 42px; height: 42px;
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  border-radius: 11px; display: flex; align-items: center; justify-content: center;
  font-family: 'Syne', sans-serif; font-weight: 800; font-size: 11px; color: white;
  flex-shrink: 0; box-shadow: 0 0 20px rgba(59,130,246,0.25); letter-spacing: -0.5px;
}

.topbar-title { font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 700; color: var(--text); }
.topbar-sub { font-size: 12px; color: var(--muted); margin-top: 1px; }

.topbar-right { margin-left: auto; display: flex; align-items: center; gap: 8px; }

.ai-badge {
  display: flex; align-items: center; gap: 6px;
  padding: 5px 11px; border-radius: 20px;
  background: var(--surface2); border: 1px solid var(--border2);
  font-size: 12px; font-weight: 500; color: var(--text2);
}
.ai-dot { width: 6px; height: 6px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }

.lang-toggle {
  display: flex; border: 1px solid var(--border2); border-radius: 10px;
  overflow: hidden; background: var(--surface2);
}
.lang-btn {
  padding: 6px 12px; font-family: 'Inter', sans-serif; font-size: 12px;
  font-weight: 500; border: none; cursor: pointer; background: none;
  color: var(--muted); transition: all 0.2s;
}
.lang-btn.active { background: var(--accent); color: white; }
.lang-btn:hover:not(.active) { color: var(--text2); }

.settings-btn {
  width: 34px; height: 34px; border-radius: 9px; border: 1px solid var(--border2);
  background: var(--surface2); cursor: pointer; display: flex; align-items: center;
  justify-content: center; color: var(--muted); font-size: 15px; transition: all 0.2s;
}
.settings-btn:hover { border-color: var(--accent); color: var(--accent); }

/* â”€â”€ CHAT APP â”€â”€ */
.app {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 20px; overflow: hidden;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.03), 0 24px 60px rgba(0,0,0,0.5);
  animation: fadeUp 0.5s ease both 0.1s;
  display: flex; flex-direction: column;
}

/* Tabs */
.tabs {
  display: flex; gap: 4px; padding: 12px 18px 0;
  border-bottom: 1px solid var(--border); overflow-x: auto; scrollbar-width: none;
  background: var(--surface);
}
.tabs::-webkit-scrollbar { display: none; }
.tab-btn {
  background: none; border: none; padding: 7px 13px;
  font-family: 'Inter', sans-serif; font-size: 12px; font-weight: 500;
  color: var(--muted); cursor: pointer; border-radius: 8px 8px 0 0;
  white-space: nowrap; transition: all 0.2s;
  border-bottom: 2px solid transparent; margin-bottom: -1px;
}
.tab-btn:hover { color: var(--text2); background: var(--surface2); }
.tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); background: rgba(59,130,246,0.08); }

/* Messages */
.messages {
  height: 440px; overflow-y: auto; padding: 22px 20px;
  display: flex; flex-direction: column; gap: 16px; scroll-behavior: smooth;
  background: var(--bg);
}
.messages::-webkit-scrollbar { width: 4px; }
.messages::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 4px; }

.message { display: flex; gap: 10px; animation: msgIn 0.3s ease both; }
.message.user { flex-direction: row-reverse; }

.avatar {
  width: 30px; height: 30px; border-radius: 9px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 10px; font-weight: 700; font-family: 'Syne', sans-serif;
}
.bot-avatar {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white; box-shadow: 0 0 12px rgba(59,130,246,0.2);
}
.user-avatar { background: #222; color: var(--muted); border: 1px solid var(--border2); }

.bubble {
  max-width: 78%; padding: 11px 15px; border-radius: 14px;
  font-size: 13.5px; line-height: 1.75;
}
.bot .bubble {
  background: var(--bot-bg); border: 1px solid var(--border);
  border-top-left-radius: 4px; color: var(--text);
}
.user .bubble {
  background: var(--user-bg); border: 1px solid rgba(59,130,246,0.3);
  border-top-right-radius: 4px; color: #c7d9ff;
}
.bubble a { color: var(--accent); text-decoration: underline; }
.bubble strong { color: var(--text); font-weight: 600; }

/* AI streaming cursor */
.cursor { display: inline-block; width: 2px; height: 14px; background: var(--accent); margin-left: 2px; animation: blink 1s infinite; vertical-align: middle; }
@keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0; } }

/* Typing dots */
.dots { display: flex; gap: 4px; align-items: center; padding: 3px 2px; }
.dots span { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); animation: bounce 1.2s infinite; }
.dots span:nth-child(2) { animation-delay: 0.2s; }
.dots span:nth-child(3) { animation-delay: 0.4s; }

/* Suggestions */
.suggestions { padding: 10px 18px 12px; display: flex; flex-wrap: wrap; gap: 6px; background: var(--surface); border-top: 1px solid var(--border); }
.suggestion-btn {
  background: var(--surface2); border: 1px solid var(--border2);
  color: var(--text2); font-family: 'Inter', sans-serif;
  font-size: 12px; padding: 5px 12px; border-radius: 20px;
  cursor: pointer; transition: all 0.2s ease;
}
.suggestion-btn:hover { background: rgba(59,130,246,0.12); border-color: var(--accent); color: var(--accent); transform: translateY(-1px); }

/* Input area */
.input-area {
  display: flex; align-items: center; gap: 8px;
  padding: 12px 16px; border-top: 1px solid var(--border);
  background: var(--surface);
}

.mode-btns { display: flex; gap: 6px; flex-shrink: 0; }

.mode-btn {
  display: flex; align-items: center; gap: 5px;
  padding: 6px 11px; border-radius: 8px; border: 1px solid var(--border2);
  background: var(--surface2); cursor: pointer; transition: all 0.2s;
  font-family: 'Inter', sans-serif; font-size: 11.5px; font-weight: 500;
  color: var(--muted); white-space: nowrap;
}
.mode-btn:hover { border-color: var(--border2); color: var(--text2); }
.mode-btn.on { background: rgba(59,130,246,0.12); border-color: var(--accent); color: var(--accent); }
.mode-btn .mdot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; opacity: 0.5; }
.mode-btn.on .mdot { opacity: 1; animation: pulse 2s infinite; }

.input-area input {
  flex: 1; background: var(--surface2); border: 1px solid var(--border2);
  border-radius: 10px; padding: 10px 14px; outline: none;
  color: var(--text); font-family: 'Inter', sans-serif; font-size: 13.5px;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.input-area input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
.input-area input::placeholder { color: var(--muted); }

.send-btn {
  width: 38px; height: 38px; border-radius: 9px;
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  border: none; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; flex-shrink: 0;
  box-shadow: 0 4px 12px rgba(59,130,246,0.3);
}
.send-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(59,130,246,0.4); }
.send-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
.send-btn svg { width: 15px; height: 15px; fill: white; }

/* Status bar */
.statusbar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 7px 18px; background: #0d0d0d; border-top: 1px solid var(--border);
  font-size: 11px; color: var(--muted);
}
.statusbar-left { display: flex; align-items: center; gap: 8px; }
.status-pill {
  display: flex; align-items: center; gap: 4px; padding: 2px 8px;
  border-radius: 10px; background: var(--surface2); border: 1px solid var(--border);
  font-size: 10.5px;
}
.status-pill.ai { color: var(--accent); border-color: rgba(59,130,246,0.3); background: rgba(59,130,246,0.08); }
.status-pill.web { color: var(--green); border-color: rgba(34,197,94,0.3); background: rgba(34,197,94,0.08); }

/* Search results */
.search-results { margin-top: 8px; }
.search-result-item {
  display: block; padding: 8px 10px; margin-bottom: 5px;
  background: var(--surface2); border: 1px solid var(--border2); border-radius: 8px;
  text-decoration: none; transition: all 0.2s; color: var(--text);
}
.search-result-item:hover { border-color: var(--accent); background: rgba(59,130,246,0.06); transform: translateY(-1px); }
.search-result-title { font-size: 12.5px; font-weight: 500; color: var(--accent); display: block; }
.search-result-url { font-size: 11px; color: var(--muted); display: block; margin-top: 2px; }
.search-badge {
  display: inline-block; font-size: 10px; padding: 2px 7px; border-radius: 8px;
  margin-bottom: 6px; font-weight: 600; letter-spacing: 0.05em;
}
.badge-strands { background: rgba(59,130,246,0.15); color: #60a5fa; }
.badge-google { background: rgba(245,158,11,0.15); color: #fbbf24; }

/* Footer */
.footer {
  display: flex; justify-content: space-between; align-items: center;
  margin-top: 14px; animation: fadeUp 0.5s ease both 0.2s;
}
.footer-left { font-size: 11.5px; color: var(--muted); }
.footer-left a { color: var(--text2); text-decoration: none; }
.footer-left a:hover { color: var(--accent); }
.footer-right { font-size: 11px; color: #333; }

@keyframes fadeDown { from { opacity:0; transform:translateY(-12px); } to { opacity:1; transform:translateY(0); } }
@keyframes fadeUp { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }
@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
@keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
@keyframes msgIn { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }
@keyframes bounce { 0%,60%,100% { transform:translateY(0); } 30% { transform:translateY(-5px); } }
@keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }
</style>
</head>
<body>

<!-- â”€â”€ SETUP MODAL â”€â”€ -->
<div class="setup-overlay" id="setupOverlay">
  <div class="setup-card">
    <div class="setup-logo">STR<br>ANDS</div>
    <h2>Connect Groq AI</h2>
    <p>Enter your free Groq API key to power this assistant with real AI. Get a key at <a href="https://console.groq.com/keys" target="_blank">console.groq.com/keys</a> â€” it's free.</p>

    <label class="setup-label">Groq API Key</label>
    <div class="api-input-wrap">
      <input type="password" id="apiKeyInput" placeholder="gsk_xxxxxxxxxxxxxxxxxxxxxxxxxx" />
      <button class="eye-btn" onclick="toggleEye()" id="eyeBtn">ğŸ‘</button>
    </div>
    <div class="api-hint">
      Your key is saved for this browser session only and sent exclusively to Groq servers when you chat.
      <br>âš ï¸ No connection test is run here â€” the key will be verified on your first message.
      <br><a href="https://console.groq.com/keys" target="_blank">â†’ Get a free API key at console.groq.com</a>
    </div>

    <label class="setup-label">AI Model</label>
    <div class="model-select-wrap">
      <select id="modelSelect">
        <option value="llama-3.3-70b-versatile">Llama 3.3 70B â€” Best quality</option>
        <option value="llama3-8b-8192">Llama 3 8B â€” Fastest</option>
        <option value="mixtral-8x7b-32768">Mixtral 8x7B â€” Balanced</option>
        <option value="gemma2-9b-it">Gemma 2 9B â€” Efficient</option>
      </select>
    </div>

    <button class="start-btn" id="startBtn" onclick="startApp()">Start Assistant â†’</button>
    <div class="setup-error" id="setupError"></div>
  </div>
</div>

<!-- â”€â”€ MAIN APP â”€â”€ -->
<div class="wrapper">
  <div class="topbar">
    <div class="logo-mark">STR<br>ANDS</div>
    <div>
      <div class="topbar-title" id="h-title">Strands AI Support</div>
      <div class="topbar-sub" id="h-sub">Powered by Groq AI Â· Bilingual Â· Always available</div>
    </div>
    <div class="topbar-right">
      <div class="ai-badge">
        <span class="ai-dot"></span>
        <span id="modelBadge">AI Ready</span>
      </div>
      <div class="lang-toggle">
        <button class="lang-btn active" onclick="setLang('en',this)">ğŸ‡¬ğŸ‡§</button>
        <button class="lang-btn" onclick="setLang('sv',this)">ğŸ‡¸ğŸ‡ª</button>
      </div>
      <button class="settings-btn" onclick="openSettings()" title="Settings">âš™ï¸</button>
    </div>
  </div>

  <div class="app">
    <div class="tabs" id="tabs"></div>
    <div class="messages" id="messages"></div>
    <div class="suggestions" id="suggestions"></div>

    <div class="input-area">
      <div class="mode-btns">
        <button class="mode-btn" id="aiBtn" onclick="toggleAI()" title="Toggle Groq AI">
          <span class="mdot"></span> AI
        </button>
        <button class="mode-btn" id="webBtn" onclick="toggleWeb()" title="Toggle Web Search">
          <span class="mdot"></span> Web
        </button>
      </div>
      <input type="text" id="userInput" placeholder="Ask anything about Strands..." onkeydown="if(event.key==='Enter')sendMessage()" />
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">
        <svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
      </button>
    </div>

    <div class="statusbar">
      <div class="statusbar-left" id="statusLeft">
        <span class="status-pill" id="aiPill">âš¡ FAQ mode</span>
      </div>
      <span id="statusRight">Strands Support Assistant</span>
    </div>
  </div>

  <div class="footer">
    <div class="footer-left">
      <a href="https://strandseurope.com" target="_blank">strandseurope.com</a> Â·
      <a href="https://console.groq.com" target="_blank">Groq AI</a>
    </div>
    <div class="footer-right">Â© Strands Group AB</div>
  </div>
</div>

<script>
const SP = 'https://strandsab.sharepoint.com/:f:/s/Aftersales/IgCYn40pqzMbRoOqLDUeQriXAVinLQoFqQg17TGDdmvMdu0?e=OumEKT';

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let lang = 'en';
let aiOn = false;
let webOn = false;
let groqKey = '';
let groqModel = 'llama-3.3-70b-versatile';
let isSending = false;

// â”€â”€ SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleEye() {
  const inp = document.getElementById('apiKeyInput');
  inp.type = inp.type === 'password' ? 'text' : 'password';
}

async function startApp() {
  const key = document.getElementById("apiKeyInput").value.trim();
  const model = document.getElementById("modelSelect").value;

  if (!key) { showSetupError("Please enter your Groq API key."); return; }
  if (!key.startsWith("gsk_")) { showSetupError("Invalid key format. Groq keys start with gsk_"); return; }
  if (key.length < 40) { showSetupError("Key seems too short. Please copy the full key from console.groq.com/keys"); return; }

  groqKey = key;
  groqModel = model;
  sessionStorage.setItem("groqKey", key);
  sessionStorage.setItem("groqModel", model);

  document.getElementById("setupOverlay").classList.add("hidden");
  document.getElementById("modelBadge").textContent = model.split("-").slice(0,2).join(" ");
  aiOn = true;
  updateModes();
  initApp();
}

function showSetupError(msg) {
  const err = document.getElementById('setupError');
  err.textContent = msg;
  err.style.display = 'block';
}

function openSettings() {
  groqKey = '';
  document.getElementById('apiKeyInput').value = '';
  document.getElementById('setupError').style.display = 'none';
  document.getElementById('startBtn').disabled = false;
  document.getElementById('startBtn').textContent = 'Start Assistant â†’';
  document.getElementById('setupOverlay').classList.remove('hidden');
}

// â”€â”€ LANGUAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const UI = {
  en: {
    title: 'Strands AI Support',
    sub: 'Powered by Groq AI Â· Bilingual Â· Always available',
    placeholder: 'Ask anything about Strands...',
    welcome: `Hi! ğŸ‘‹ I'm the Strands AI assistant powered by Groq.\n\nI can help with:\nâ€¢ Light technology, ECE, IP ratings, lumen/lux\nâ€¢ Orders, delivery & returns\nâ€¢ Warranty & claims\nâ€¢ CAN bus & XBB installation\nâ€¢ Product questions\n\nğŸ’¡ Toggle <strong>AI</strong> mode for smart answers, <strong>Web</strong> for live search results â€” or use both together!`,
    tabs: ['All','Tech & Facts','Orders & Delivery','Warranty & Returns','CAN bus & XBB','Products','Contact'],
    tabKeys: ['all','tech','order','warranty','canbus','product','contact'],
    fallback: `I couldn't find a specific answer. Here are some resources:\n\nğŸ“§ <a href="mailto:support@strands.se">support@strands.se</a>\nğŸ“ +46(0)320-450450\nğŸ“ <a href="${SP}" target="_blank">Aftersales documents â†’</a>\nğŸ”— <a href="https://strandseurope.com" target="_blank">strandseurope.com â†’</a>`,
    categories: {
      all: ['What light technology types exist?','What is lumen and lux?','What are ECE regulations?','How long is the warranty?','How do I track my order?','Do I need a CAN bus interface?','What is IP rating?','How do I contact support?','Where are the Aftersales documents?'],
      tech: ['Light technology types','What is lumen and lux?','What is Kelvin?','Beam patterns explained','ECE regulations','IP rating explained','Relay and fuse sizing'],
      order: ['Minimum order?','Change my order','Delivery times','Track my order','Express delivery?','Wrong product received','Missing items'],
      warranty: ['Warranty period','Product broken â€” claim','Return a product','Warranty with modifications?','Cut the DT connector?','Cut the cable?'],
      canbus: ['When do I need CAN bus?','Will XBB work with my car?','LED tail light resistors','Car software update & CAN bus','High beam automatics'],
      product: ['Choose a driving light','No-Glare technology','E-mode vs Xperience mode','Condensation in lamp','Find product manual','Spare parts'],
      contact: ['Contact support','Become a reseller','Opening hours','Aftersales documents folder']
    }
  },
  sv: {
    title: 'Strands AI Support',
    sub: 'Drivs av Groq AI Â· TvÃ¥sprÃ¥kig Â· Alltid tillgÃ¤nglig',
    placeholder: 'FrÃ¥ga nÃ¥got om Strands...',
    welcome: `Hej! ğŸ‘‹ Jag Ã¤r Strands AI-assistent driven av Groq.\n\nJag kan hjÃ¤lpa med:\nâ€¢ Ljusteknik, ECE, IP-klass, lumen/lux\nâ€¢ Order, leverans & retur\nâ€¢ Garanti & reklamation\nâ€¢ CAN bus & XBB-installation\nâ€¢ ProduktfrÃ¥gor\n\nğŸ’¡ Aktivera <strong>AI</strong>-lÃ¤ge fÃ¶r smarta svar, <strong>Webb</strong> fÃ¶r live-sÃ¶kresultat â€” eller anvÃ¤nd bÃ¥da!`,
    tabs: ['Alla','Teknik & fakta','Order & leverans','Garanti & retur','CAN bus & XBB','Produkter','Kontakt'],
    tabKeys: ['all','tech','order','warranty','canbus','product','contact'],
    fallback: `Jag hittade inget specifikt svar. HÃ¤r Ã¤r nÃ¥gra resurser:\n\nğŸ“§ <a href="mailto:support@strands.se">support@strands.se</a>\nğŸ“ +46(0)320-450450\nğŸ“ <a href="${SP}" target="_blank">Aftersales-dokument â†’</a>\nğŸ”— <a href="https://strandseurope.com" target="_blank">strandseurope.com â†’</a>`,
    categories: {
      all: ['Vilka ljustekniker finns?','Vad Ã¤r lumen och lux?','Vad Ã¤r ECE-reglerna?','Hur lÃ¥ng Ã¤r garantin?','Hur spÃ¥rar jag min order?','BehÃ¶ver jag CAN bus-interface?','Vad Ã¤r IP-klassning?','Hur kontaktar jag support?','Var finns Aftersales-dokument?'],
      tech: ['Ljustekniker','Lumen och lux','Vad Ã¤r Kelvin?','Ljusbilder fÃ¶rklarade','ECE-reglerna','IP-klassning','RelÃ¤ och sÃ¤kring'],
      order: ['Minsta ordergrÃ¤ns?','Ã„ndra bestÃ¤llning','Leveranstid','SpÃ¥ra min order','Expressfrakt?','FÃ¥tt fel vara','Saknas varor'],
      warranty: ['Garantitid','Produkt gÃ¥tt sÃ¶nder','Returnera produkt','Garanti vid modifiering?','Klippa DT-kontakten?','Klippa kabeln?'],
      canbus: ['NÃ¤r behÃ¶vs CAN bus?','Fungerar XBB med min bil?','LED-bakljus motstÃ¥nd','Biluppdatering & CAN bus','Helljusautomatik'],
      product: ['VÃ¤lja extraljus','No-Glare-tekniken','E-lÃ¤ge vs Xperience','Kondens i lampa','Hitta manual','Reservdelar'],
      contact: ['Kontakta support','Bli Ã¥terfÃ¶rsÃ¤ljare','Ã–ppettider','Aftersales-dokumentmapp']
    }
  }
};

// â”€â”€ FAQ KNOWLEDGE BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const FAQ = [
  { cat:'tech', keywords:{en:['light technology','halogen','xenon','led','types of lights'],sv:['ljusteknik','halogen','xenon','led','ljustekniker']},
    answer:{en:`The most common types are halogen, xenon, and LED:\n\nğŸ’¡ Halogen â€” Filament + halogen gas. Bright but shorter lifespan than LED/xenon. Generates heat.\nğŸ’¡ Xenon â€” Xenon gas, no filament. Longer lifespan, lower consumption. Slow startup.\nğŸ’¡ LED â€” Most common in Strands products. Very long lifespan, low power, instant on, vibration-resistant.\n\nğŸ”— <a href="https://strands.se/kunskapsbank/valj-ratt-extraljus-den-ultimata-guiden/" target="_blank">Knowledge bank â†’</a>`,
    sv:`De vanligaste teknikerna Ã¤r halogen, xenon och LED:\n\nğŸ’¡ Halogen â€” GlÃ¶dtrÃ¥d + halogengas. Stark men kortare livslÃ¤ngd. HÃ¶g vÃ¤rmeutveckling.\nğŸ’¡ Xenon â€” Xenongas, ingen glÃ¶dtrÃ¥d. LÃ¥ng livslÃ¤ngd, lÃ¥g fÃ¶rbrukning. LÃ¥ngsam uppstartning.\nğŸ’¡ LED â€” Vanligast i Strands sortiment. Mycket lÃ¥ng livslÃ¤ngd, lÃ¥g fÃ¶rbrukning, omedelbar tÃ¤ndning.\n\nğŸ”— <a href="https://strands.se/kunskapsbank/valj-ratt-extraljus-den-ultimata-guiden/" target="_blank">Kunskapsbank â†’</a>`}},
  { cat:'tech', keywords:{en:['lumen','lux','brightness','intensity','luminous'],sv:['lumen','lux','ljusstyrka','intensitet']},
    answer:{en:`ğŸ“ Lumen â€” Luminous flux from a light source (actual strength). Strands always uses actual lumens, not theoretical.\nğŸ“ Lux â€” Illuminance on a surface. 1 lux = 1 lumen/mÂ². Driving lights are rated as "1 lux @ X meters".\n\nğŸ”¬ All Strands lights are measured in our own advanced light laboratory.`,
    sv:`ğŸ“ Lumen â€” LjusflÃ¶det frÃ¥n en ljuskÃ¤lla (faktisk styrka). Strands anger alltid faktiska lumen.\nğŸ“ Lux â€” Luminansen pÃ¥ en yta. 1 lux = 1 lumen/mÂ². Extraljus anges som "1 lux @ X meter".\n\nğŸ”¬ Alla Strands-lampor mÃ¤ts i vÃ¥rt avancerade ljuslaboratorium.`}},
  { cat:'tech', keywords:{en:['kelvin','color temperature','warm','cool'],sv:['kelvin','fÃ¤rgtemperatur','varm','kall']},
    answer:{en:`Higher Kelvin = cooler/bluer light. Lower Kelvin = warmer/redder.\n\nFor driving & work lights: cooler temperature (higher K) gives a clearer beam.\nFor rain/snow: warmer temperature reduces glare from water particles.`,
    sv:`HÃ¶gre Kelvin = kallare/blÃ¥are ljus. LÃ¤gre Kelvin = varmare/rÃ¶dare.\n\nFÃ¶r extra- och arbetsljus: kallare temperatur (hÃ¶gre K) ger en klarare ljusbild.\nVid regn/snÃ¶: varmare temperatur minskar reflexer frÃ¥n vattenpartiklar.`}},
  { cat:'tech', keywords:{en:['beam pattern','flood','combo','pencil','optimized','extended','long-distance'],sv:['ljusbild','flood','combo','pencil','optimized','extended']},
    answer:{en:`ğŸ”¦ Optimized (Flood) â€” Widest beam. Best for winding roads, spots animals on the sides.\nğŸ”¦ Extended (Combo) â€” Width + distance combined. Versatile all-rounder.\nğŸ”¦ Long-distance (Pencil) â€” Narrow, maximum range. Best for highways and mountain roads.`,
    sv:`ğŸ”¦ Optimized (Flood) â€” Bredast. BÃ¤st fÃ¶r kurviga vÃ¤gar, ser djur lÃ¤ngs kanten.\nğŸ”¦ Extended (Combo) â€” Kombination bredd + rÃ¤ckvidd. MÃ¥ngsidig.\nğŸ”¦ Long-distance (Pencil) â€” Smal, maximal rÃ¤ckvidd. BÃ¤st fÃ¶r motorvÃ¤gar och fjÃ¤llvÃ¤gar.`}},
  { cat:'tech', keywords:{en:['ece','e-approved','regulations','legal','road legal'],sv:['ece','e-godkÃ¤nt','reglemente','laglig']},
    answer:{en:`ECE regulations govern vehicle lighting â€” which lights are allowed, their intensity, and how they're installed.\n\nKey points:\nâ€¢ Driving lights must not be too powerful\nâ€¢ Placement and quantity rules apply\nâ€¢ Many Strands lights have E-mode (road legal) and Xperience mode\nâ€¢ ECE R112 = Halogen & LED headlamps; ECE R87 = DRL; ECE R91 = Side markers`,
    sv:`ECE-reglementet reglerar fordonsbelysning â€” vilka lampor som tillÃ¥ts, deras intensitet och hur de monteras.\n\nViktigt:\nâ€¢ Extraljus fÃ¥r inte vara fÃ¶r starka\nâ€¢ Regler fÃ¶r antal och placering gÃ¤ller\nâ€¢ MÃ¥nga Strands-lampor har E-lÃ¤ge (lagligt) och Xperience-lÃ¤ge\nâ€¢ ECE R112 = Halogen/LED-strÃ¥lkastare; ECE R87 = Varselljus; ECE R91 = Sidomarkeringsljus`}},
  { cat:'tech', keywords:{en:['ip rating','ip class','waterproof','dustproof'],sv:['ip-klassning','ip-klass','vattentÃ¤t','dammtÃ¤t']},
    answer:{en:`IP rating = protection against solids (1st digit) and water (2nd digit).\n\nFirst digit: 5=dust protected, 6=dust-tight\nSecond digit: 5=water jets, 6=powerful jets, 7=temporary submersion, 8=continuous, 9K=high pressure/temp\n\nExample: IP66 = dust-tight + powerful water jets.`,
    sv:`IP-klassning = skydd mot fasta Ã¤mnen (1:a siffran) och vatten (2:a siffran).\n\n1:a siffran: 5=dammskyddad, 6=dammtÃ¤t\n2:a siffran: 5=vattenstrÃ¥le, 6=kraftig spolning, 7=tillfÃ¤llig nedsÃ¤nkning, 8=lÃ¥ngvarig, 9K=hÃ¶gtryck/varmvatten\n\nExempel: IP66 = dammtÃ¤t + kraftig vattenspolning.`}},
  { cat:'tech', keywords:{en:['relay','fuse','cable','amp','ampere','wire'],sv:['relÃ¤','sÃ¤kring','kabel','ampere']},
    answer:{en:`â€¢ Relay: â‰¥10% above max load, higher amps than fuse\nâ€¢ Fuse: Just above total max load â€” always the weakest link so it fails first\nâ€¢ Cable cross-section: Depends on load, length, material â€” no universal answer\n\nâš ï¸ If unsure, consult a vehicle electrician.`,
    sv:`â€¢ RelÃ¤: â‰¥10% Ã¶ver maxeffekten, hÃ¶gre ampere Ã¤n sÃ¤kringen\nâ€¢ SÃ¤kring: Strax Ã¶ver total maxeffekt â€” alltid svagaste lÃ¤nken\nâ€¢ Kabelarea: Beror pÃ¥ effekt, lÃ¤ngd, material â€” inget generellt svar\n\nâš ï¸ Ã„r du osÃ¤ker, anlita en fordonselektriker.`}},
  // ORDER
  { cat:'order', keywords:{en:['minimum order','order limit'],sv:['minsta order','ordergrÃ¤ns']},
    answer:{en:`No minimum order at Strands. Order as little or as much as you need! ğŸ›’`,sv:`Ingen minsta ordergrÃ¤ns hos Strands. BestÃ¤ll hur lite eller mycket du vill! ğŸ›’`}},
  { cat:'order', keywords:{en:['change order','modify order','cancel order'],sv:['Ã¤ndra bestÃ¤llning','Ã¤ndra order','avboka']},
    answer:{en:`Orders are processed promptly â€” no changes once confirmed (incl. delivery address).\nIf not yet confirmed: ğŸ“ +46(0)320-450450 (08:00â€“17:00 business days)`,
    sv:`BestÃ¤llningar behandlas omgÃ¥ende â€” inga Ã¤ndringar efter bekrÃ¤ftelse (inkl. leveransadress).\nOm ej bekrÃ¤ftad: ğŸ“ +46(0)320-450450 (08:00â€“17:00 vardagar)`}},
  { cat:'order', keywords:{en:['track order','tracking','where is my order'],sv:['spÃ¥ra bestÃ¤llning','spÃ¥ra paket','var Ã¤r mitt']},
    answer:{en:`You'll receive a tracking email once your order is shipped. Also available via the PostNord app.`,
    sv:`Du fÃ¥r ett spÃ¥rnings-mejl nÃ¤r din bestÃ¤llning skickats. Du kan ocksÃ¥ fÃ¶lja det via PostNords app.`}},
  { cat:'order', keywords:{en:['express delivery','express shipping','fast delivery'],sv:['expressfrakt','snabb leverans']},
    answer:{en:`Strands does not offer express delivery. We ship via PostNord (no express option).`,sv:`Strands erbjuder ingen expressfrakt. Vi skickar via PostNord (ingen expressoption).`}},
  { cat:'order', keywords:{en:['delivery time','how long','shipping time'],sv:['leveranstid','hur lÃ¥ng','nÃ¤r kommer']},
    answer:{en:`ğŸ‡¸ğŸ‡ª Sweden: ~1â€“4 business days.\nğŸŒ International: Contact support@strands.se for estimate.`,
    sv:`ğŸ‡¸ğŸ‡ª Sverige: ~1â€“4 vardagar.\nğŸŒ Utomlands: Kontakta support@strands.se fÃ¶r uppskattning.`}},
  { cat:'order', keywords:{en:['missing item','items missing'],sv:['saknas varor','varor saknas']},
    answer:{en:`Missing items may be on backorder or a picking error occurred.\nğŸ“§ support@strands.se Â· ğŸ“ +46(0)320-450450`,
    sv:`Saknade varor kan vara restnoterade eller ett plockfel har skett.\nğŸ“§ support@strands.se Â· ğŸ“ +46(0)320-450450`}},
  { cat:'order', keywords:{en:['wrong product','wrong item','received wrong'],sv:['fel vara','fel produkt','fick fel']},
    answer:{en:`We apologize! Contact us and we'll assist promptly:\nğŸ“§ support@strands.se Â· ğŸ“ +46(0)320-450450`,
    sv:`Vi beklagar! Kontakta oss sÃ¥ hjÃ¤lper vi dig direkt:\nğŸ“§ support@strands.se Â· ğŸ“ +46(0)320-450450`}},
  { cat:'order', keywords:{en:['reseller','become reseller','retailer'],sv:['Ã¥terfÃ¶rsÃ¤ljare','bli Ã¥terfÃ¶rsÃ¤ljare']},
    answer:{en:`Interested in becoming a Strands reseller?\nğŸ“§ order@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/become-a-retailer" target="_blank">Fill in the form â†’</a>`,
    sv:`Intresserad av att bli Ã¥terfÃ¶rsÃ¤ljare?\nğŸ“§ order@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/become-a-retailer" target="_blank">Fyll i formulÃ¤ret â†’</a>`}},
  // WARRANTY
  { cat:'warranty', keywords:{en:['warranty','guarantee','warranty period'],sv:['garanti','garantitid','garantiperiod']},
    answer:{en:`SLD products: 3â€“6 year warranty. Other ranges: typically 1 year.\nCovers manufacturing defects only â€” NOT incorrect use or installation.\nğŸ”— <a href="https://strandseurope.com/sv/about-us/function-warranty" target="_blank">Full warranty terms â†’</a>\nğŸ“ <a href="${SP}" target="_blank">Aftersales documents â†’</a>`,
    sv:`SLD-produkter: 3â€“6 Ã¥r garanti. Ã–vriga: normalt 1 Ã¥r.\nTÃ¤cker tillverkningsfel â€” INTE felaktig anvÃ¤ndning.\nğŸ”— <a href="https://strandseurope.com/sv/about-us/function-warranty" target="_blank">Garantivillkor â†’</a>\nğŸ“ <a href="${SP}" target="_blank">Aftersales-dokument â†’</a>`}},
  { cat:'warranty', keywords:{en:['product broken','stopped working','warranty claim','make a claim'],sv:['produkt gÃ¥tt sÃ¶nder','slutat fungera','reklamation']},
    answer:{en:`Product broken?\nâ€¢ Bought from retailer â†’ contact retailer\nâ€¢ Direct claim: ğŸ“§ reklamation@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/contact/claims-and-returns" target="_blank">Claims & returns â†’</a>\nğŸ“ <a href="${SP}" target="_blank">Aftersales documents â†’</a>`,
    sv:`Produkt gÃ¥tt sÃ¶nder?\nâ€¢ KÃ¶pt frÃ¥n Ã¥terfÃ¶rsÃ¤ljare â†’ kontakta Ã¥terfÃ¶rsÃ¤ljaren\nâ€¢ Direkt: ğŸ“§ reklamation@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/contact/claims-and-returns" target="_blank">Reklamation & retur â†’</a>\nğŸ“ <a href="${SP}" target="_blank">Aftersales-dokument â†’</a>`}},
  { cat:'warranty', keywords:{en:['return','regret','cancel','right of withdrawal'],sv:['retur','Ã¥ngra','returnera','Ã¥ngervrÃ¤tt']},
    answer:{en:`Right of withdrawal doesn't apply to B2B. However Strands is solution-oriented â€” contact us early:\nğŸ“§ support@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/contact/claims-and-returns" target="_blank">Returns page â†’</a>`,
    sv:`Ã…ngerrÃ¤tten gÃ¤ller inte B2B. Strands Ã¤r dock lÃ¶sningsorienterade â€” kontakta oss tidigt:\nğŸ“§ support@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/contact/claims-and-returns" target="_blank">Retursida â†’</a>`}},
  { cat:'warranty', keywords:{en:['cut dt connector','dt connector'],sv:['klippa dt-kontakt','dt-kontakt']},
    answer:{en:`No, warranty is VOID if you cut the DT connector.\nğŸ”— <a href="https://strandseurope.com/sv/about-us/function-warranty" target="_blank">Warranty terms â†’</a>`,
    sv:`Nej, garantin UPPHÃ–R om du klipper DT-kontakten.\nğŸ”— <a href="https://strandseurope.com/sv/about-us/function-warranty" target="_blank">Garantivillkor â†’</a>`}},
  { cat:'warranty', keywords:{en:['cut cable','shorten cable'],sv:['klippa kabeln','korta kabeln']},
    answer:{en:`Warranty void if cable is cut shorter than 50 cm.\nğŸ”— <a href="https://strandseurope.com/sv/about-us/function-warranty" target="_blank">Warranty terms â†’</a>`,
    sv:`Garantin gÃ¤ller inte om kabeln klipps kortare Ã¤n 50 cm.\nğŸ”— <a href="https://strandseurope.com/sv/about-us/function-warranty" target="_blank">Garantivillkor â†’</a>`}},
  { cat:'warranty', keywords:{en:['modify','disassemble','open','modification'],sv:['modifiera','Ã¶ppna','demontera','modifiering']},
    answer:{en:`Modifying = warranty void. Opening a sealed product (LED bar etc.) = warranty void. Opening products designed to be opened (halogen lamp for bulb change) = warranty maintained.`,
    sv:`Modifiering = garantin upphÃ¶r. Ã–ppna fÃ¶rseglad produkt (LED-bar m.m.) = garantin upphÃ¶r. Ã–ppna produkter avsedda att Ã¶ppnas (halogen fÃ¶r byte av glÃ¶dlampa) = garantin gÃ¤ller.`}},
  // CAN BUS
  { cat:'canbus', keywords:{en:['canbus interface','can bus','270417','when do i need'],sv:['canbus interface','can bus','270417','nÃ¤r behÃ¶vs']},
    answer:{en:`You need a CAN bus interface (270417) when you want driving lights to activate with the high beam AND your vehicle only delivers a current pulse (not constant power) to the high beam. Mainly applies to xenon or LED headlamp vehicles.`,
    sv:`Du behÃ¶ver Canbus Interface (270417) nÃ¤r du vill att extraljuset ska aktiveras med helljuset OCH bilen bara ger en strÃ¶mimpuls (inte konstant strÃ¶m) till helljuset. GÃ¤ller frÃ¤mst bilar med xenon- eller LED-strÃ¥lkastare.`}},
  { cat:'canbus', keywords:{en:['high beam automatic','adaptive high beam'],sv:['helljusautomatik','adaptivt helljus']},
    answer:{en:`Adaptive/automatic high beam does NOT work with the CAN bus interface (270417). Manual high beam still works.`,
    sv:`Helljusautomatik fungerar INTE med Canbus Interface (270417). Manuellt helljus fungerar fortfarande.`}},
  { cat:'canbus', keywords:{en:['software update','car update'],sv:['mjukvaruuppdatering','biluppdatering']},
    answer:{en:`After a car software update the CAN bus interface may stop working (new signals). It needs updating through Nitor. If over 12 months old, it may need replacing.`,
    sv:`Efter en biluppdatering kan Canbus-interfacet sluta fungera (nya signaler). Det behÃ¶ver uppdateras via Nitor. Om det Ã¤r Ã¤ldre Ã¤n 12 mÃ¥nader kan det behÃ¶va bytas.`}},
  { cat:'canbus', keywords:{en:['resistor','led taillights','tail light'],sv:['motstÃ¥nd','led-bakljus','bakljus']},
    answer:{en:`Some cars work fine with LED taillights, others need a resistor. ğŸ’¡ Try without resistor first â€” add one if needed.`,
    sv:`Vissa bilar fungerar fint, andra behÃ¶ver motstÃ¥nd. ğŸ’¡ Prova utan motstÃ¥nd fÃ¶rst â€” kÃ¶p ett om det inte fungerar.`}},
  { cat:'canbus', keywords:{en:['xbb dongle','will xbb work','obd port locked','pp-can'],sv:['xbb dongle','fungerar xbb','obd port lÃ¥st','pp-can']},
    answer:{en:`Will XBB work with your car? Probably yes â€” check two things:\n1. Recipe list: <a href="https://www.xbb.se/xbbTable/bilmodeller.php" target="_blank">compatible cars â†’</a>\n2. OBD port: Some newer cars (Volvo post-2017, certain Mercedes/VAG) have a Secure Gateway.\n\nâ€¢ Open OBD: Kit 270425 + wiring 907003\nâ€¢ Locked OBD: PP-CAN + wiring 907051/907052\nâ€¢ No OBD: PP-CAN-FD\n\nğŸ“§ Send your reg. number to support@strands.se for confirmation.`,
    sv:`Fungerar XBB med din bil? FÃ¶rmodligen ja â€” kolla tvÃ¥ saker:\n1. Receptlista: <a href="https://www.xbb.se/xbbTable/bilmodeller.php" target="_blank">kompatibla bilar â†’</a>\n2. OBD-port: Nyare bilar (Volvo efter 2017, vissa Mercedes/VAG) kan ha Secure Gateway.\n\nâ€¢ Ã–ppen OBD: Kit 270425 + kablage 907003\nâ€¢ LÃ¥st OBD: PP-CAN + kablage 907051/907052\nâ€¢ Ingen OBD: PP-CAN-FD\n\nğŸ“§ Skicka ditt reg.nr till support@strands.se fÃ¶r bekrÃ¤ftelse.`}},
  // PRODUCTS
  { cat:'product', keywords:{en:['which light','choose driving light','what light for'],sv:['vilket extraljus','vÃ¤lja ljus','vilket ljus']},
    answer:{en:`ğŸš› Large car/truck â†’ 9" driving light or large LED bar\nğŸš LCV/car â†’ 7" driving light or slim LED bar\n\nBeam: Long straight roads â†’ pencil/long-distance. Winding roads â†’ flood/optimized.\n\nğŸ”— <a href="https://strandseurope.com" target="_blank">Browse products â†’</a>`,
    sv:`ğŸš› Stor bil/lastbil â†’ 9" extraljus eller stor LED-bar\nğŸš LÃ¤tt lastbil/bil â†’ 7" extraljus eller smal LED-bar\n\nLjusbild: Raka vÃ¤gar â†’ pencil/long-distance. Kurviga vÃ¤gar â†’ flood/optimized.\n\nğŸ”— <a href="https://strandseurope.com" target="_blank">Hitta produkter â†’</a>`}},
  { cat:'product', keywords:{en:['no-glare','noglare','for9t'],sv:['no-glare','for9t','blÃ¤ndfri']},
    answer:{en:`No-Glare (FOR9T): Unique lens divides beam â€” stronger at bottom, diffused higher up. Less blinding, focused exactly where needed.`,
    sv:`No-Glare (FOR9T): Unik lins delar strÃ¥len â€” starkare nedtill, diffust uppÃ¥t. Mindre blÃ¤ndande, fokuserat precis dÃ¤r det behÃ¶vs.`}},
  { cat:'product', keywords:{en:['e-mode','xperience mode','two modes'],sv:['e-lÃ¤ge','xperience-lÃ¤ge','e-mode']},
    answer:{en:`âœ… E-mode â€” Road legal, E-approved. Good for rain/snow (less glare).\nâš¡ Xperience mode â€” Maximum power. Best luminosity & range for dark conditions.`,
    sv:`âœ… E-lÃ¤ge â€” Lagligt, E-godkÃ¤nt. Bra vid regn/snÃ¶ (mindre reflexer).\nâš¡ Xperience-lÃ¤ge â€” Maximal effekt. BÃ¤sta ljusstyrka & rÃ¤ckvidd i mÃ¶rker.`}},
  { cat:'product', keywords:{en:['condensation','moisture','water inside lamp'],sv:['kondens','fukt','vatten i lampa']},
    answer:{en:`Condensation inside is normal (humidity + temperature changes). Most lights have a breather vent â€” moisture dissipates when you use the lamp. No action needed.`,
    sv:`Kondens inuti Ã¤r normalt (luftfuktighet + temperaturvÃ¤xlingar). De flesta lampor har andningshÃ¥l â€” fukten fÃ¶rsvinner nÃ¤r du anvÃ¤nder lampan. Ingen Ã¥tgÃ¤rd krÃ¤vs.`}},
  { cat:'product', keywords:{en:['manual','instruction','find manual'],sv:['manual','instruktion','hitta manual']},
    answer:{en:`Find manuals on the product page at strandseurope.com.\n\nCan't find it? ğŸ“§ support@strands.se\nğŸ“ <a href="${SP}" target="_blank">Aftersales documents folder â†’</a>`,
    sv:`Hitta manualer pÃ¥ produktsidan pÃ¥ strandseurope.com.\n\nHittar du den inte? ğŸ“§ support@strands.se\nğŸ“ <a href="${SP}" target="_blank">Aftersales-dokumentmapp â†’</a>`}},
  { cat:'product', keywords:{en:['spare parts','replacement parts'],sv:['reservdelar','ersÃ¤ttningsdelar']},
    answer:{en:`Sometimes Strands can provide spare parts.\nğŸ“§ support@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/kategorier/monteringstillbehor/fasten" target="_blank">Mounting accessories â†’</a>`,
    sv:`Strands kan i vissa fall erbjuda reservdelar.\nğŸ“§ support@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/kategorier/monteringstillbehor/fasten" target="_blank">MonteringstillbehÃ¶r â†’</a>`}},
  // CONTACT
  { cat:'contact', keywords:{en:['contact','support','phone','email','customer service','opening hours'],sv:['kontakt','support','telefon','mejl','kundservice','Ã¶ppettider']},
    answer:{en:`ğŸ“ +46(0)320-450450\nğŸ“§ Customer service: order@strands.se\nğŸ“§ Technical support: support@strands.se\nğŸ“§ Warranty claims: reklamation@strands.se\n\nğŸ• 08:00â€“17:00 business days (24h email response)\n\nğŸ¢ Strands Group AB, HagalundsvÃ¤gen, 51172 Fritsla, Sweden\nğŸ“ <a href="${SP}" target="_blank">Aftersales documents folder â†’</a>`,
    sv:`ğŸ“ +46(0)320-450450\nğŸ“§ Kundservice: order@strands.se\nğŸ“§ Teknisk support: support@strands.se\nğŸ“§ Reklamation: reklamation@strands.se\n\nğŸ• 08:00â€“17:00 vardagar (24h mejlsvar)\n\nğŸ¢ Strands Group AB, HagalundsvÃ¤gen, 51172 Fritsla, Sverige\nğŸ“ <a href="${SP}" target="_blank">Aftersales-dokumentmapp â†’</a>`}},
  { cat:'contact', keywords:{en:['document','documents','download','file','sharepoint','aftersales folder'],sv:['dokument','ladda ner','fil','mapp','sharepoint','aftersales']},
    answer:{en:`Access all Aftersales documents (manuals, warranty terms, return forms):\n\nğŸ“ <a href="${SP}" target="_blank">Open Aftersales documents folder â†’</a>\n\nâš ï¸ You need to be logged in with your Strands Microsoft 365 account.`,
    sv:`TillgÃ¥ng till alla Aftersales-dokument (manualer, garantivillkor, returformulÃ¤r):\n\nğŸ“ <a href="${SP}" target="_blank">Ã–ppna Aftersales-dokumentmapp â†’</a>\n\nâš ï¸ Du behÃ¶ver vara inloggad med ditt Strands Microsoft 365-konto.`}}
];

// â”€â”€ GROQ SYSTEM PROMPT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SYSTEM_PROMPT = `You are the official Strands AI support assistant for Strands Group AB, a Swedish company specializing in professional vehicle lighting (LED bars, driving lights, work lights).

Answer in the same language the user writes in (Swedish or English). Be concise, helpful, and professional. Use bullet points for clarity when listing steps or options.

Key knowledge:
- Products: LED bars, driving lights, work lights, side markers, warning lights, CAN bus interfaces, XBB system
- Technology: lumen, lux, Kelvin, IP rating, ECE regulations, beam patterns (flood/combo/pencil)
- ECE: E-approval required for road-legal use. Many Strands lights have E-mode (legal) and Xperience mode (max power)
- Warranty: SLD products 3-6 years, others typically 1 year. Void if: DT connector cut, cable cut under 50cm, product modified/disassembled without permission
- Orders: No minimum, PostNord shipping, Sweden 1-4 business days, no express
- CAN bus: Interface 270417 needed when car delivers only current pulse to high beam (not constant). XBB Dongle works via OBD2 port, but some newer cars (Volvo post-2017, Mercedes MRA2, newer VAG) need PP-CAN solution
- Contacts: support@strands.se, order@strands.se, reklamation@strands.se, phone +46(0)320-450450, open 08:00-17:00 weekdays
- SharePoint Aftersales documents: ${SP}
- Website: strandseurope.com

Always be helpful and accurate. If unsure, direct to support@strands.se.`;

// â”€â”€ FAQ MATCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function findFaqAnswer(query) {
  const q = query.toLowerCase();
  let best = null, bestScore = 0;
  for (const faq of FAQ) {
    let score = 0;
    const kws = [...(faq.keywords[lang]||[]), ...(faq.keywords[lang==='en'?'sv':'en']||[])];
    for (const kw of kws) {
      if (q.includes(kw.toLowerCase())) score += kw.split(' ').length;
    }
    if (score > bestScore) { bestScore = score; best = faq; }
  }
  return bestScore > 0 ? (best.answer[lang] || best.answer.en) : null;
}

// â”€â”€ GROQ AI CALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function callGroq(userMessage, streamEl) {
  const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
    method: 'POST',
    headers: { 'Authorization': `Bearer ${groqKey}`, 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: groqModel,
      messages: [
        { role: 'system', content: SYSTEM_PROMPT },
        { role: 'user', content: userMessage }
      ],
      max_tokens: 600,
      stream: true
    })
  });

  if (!res.ok) {
    const err = await res.json();
    throw new Error(err.error?.message || 'Groq API error');
  }

  const reader = res.body.getReader();
  const decoder = new TextDecoder();
  let full = '';

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    const chunk = decoder.decode(value);
    const lines = chunk.split('\n').filter(l => l.startsWith('data:'));
    for (const line of lines) {
      const data = line.replace('data: ', '');
      if (data === '[DONE]') break;
      try {
        const json = JSON.parse(data);
        const delta = json.choices?.[0]?.delta?.content || '';
        full += delta;
        // Live stream into bubble
        streamEl.innerHTML = full.replace(/\n/g, '<br>') + '<span class="cursor"></span>';
        streamEl.closest('.messages').scrollTop = streamEl.closest('.messages').scrollHeight;
      } catch {}
    }
  }
  // Remove cursor when done
  streamEl.innerHTML = full.replace(/\n/g, '<br>');
  return full;
}

// â”€â”€ WEB SEARCH LINKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildWebLinks(query) {
  const q = encodeURIComponent(query);
  const gq = encodeURIComponent('Strands lighting ' + query);
  const sq = encodeURIComponent(query + ' site:strandseurope.com');
  const isEn = lang === 'en';
  return `<div class="search-results">
<span class="search-badge badge-strands">strandseurope.com</span><br>
<a class="search-result-item" href="https://strandseurope.com/?s=${q}" target="_blank">
  <span class="search-result-title">ğŸ” ${isEn?'Search on strandseurope.com':'SÃ¶k pÃ¥ strandseurope.com'}</span>
  <span class="search-result-url">strandseurope.com</span>
</a>
<a class="search-result-item" href="https://duckduckgo.com/?q=${sq}" target="_blank">
  <span class="search-result-title">ğŸ” ${isEn?'DuckDuckGo â€” Strands site search':'DuckDuckGo â€” Strands webbsÃ¶kning'}</span>
  <span class="search-result-url">duckduckgo.com Â· site:strandseurope.com</span>
</a>
<span class="search-badge badge-google" style="margin-top:4px">Google</span><br>
<a class="search-result-item" href="https://www.google.com/search?q=${gq}" target="_blank">
  <span class="search-result-title">ğŸ” ${isEn?'Search on Google':'SÃ¶k pÃ¥ Google'}</span>
  <span class="search-result-url">google.com Â· Strands lighting</span>
</a>
<a class="search-result-item" href="mailto:support@strands.se?subject=${q}">
  <span class="search-result-title">ğŸ“§ ${isEn?'Email Strands support':'Mejla Strands support'}</span>
  <span class="search-result-url">support@strands.se</span>
</a></div>`;
}

// â”€â”€ MODES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleAI() { aiOn = !aiOn; updateModes(); }
function toggleWeb() { webOn = !webOn; updateModes(); }

function updateModes() {
  const aiBtn = document.getElementById('aiBtn');
  const webBtn = document.getElementById('webBtn');
  const aiPill = document.getElementById('aiPill');
  const statusRight = document.getElementById('statusRight');

  aiBtn.classList.toggle('on', aiOn);
  webBtn.classList.toggle('on', webOn);

  aiBtn.querySelector('.mdot').style.display = 'block';
  webBtn.querySelector('.mdot').style.display = 'block';

  if (aiOn && webOn) {
    aiPill.textContent = 'âš¡ AI + ğŸ” Web';
    aiPill.className = 'status-pill ai';
    statusRight.textContent = groqModel.split('-').slice(0,3).join('-');
  } else if (aiOn) {
    aiPill.textContent = `âš¡ ${groqModel.split('-').slice(0,2).join(' ')}`;
    aiPill.className = 'status-pill ai';
    statusRight.textContent = 'Groq AI active';
  } else if (webOn) {
    aiPill.textContent = 'ğŸ” Web search ON';
    aiPill.className = 'status-pill web';
    statusRight.textContent = 'strandseurope.com + Google';
  } else {
    aiPill.textContent = 'âš¡ FAQ mode';
    aiPill.className = 'status-pill';
    statusRight.textContent = 'Strands Support Assistant';
  }

  // Update search label for web btn
  webBtn.innerHTML = `<span class="mdot"></span> ${lang==='sv'?'Webb':'Web'}`;
  aiBtn.innerHTML = `<span class="mdot"></span> AI`;
  aiBtn.classList.toggle('on', aiOn);
  webBtn.classList.toggle('on', webOn);
}

// â”€â”€ CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addMessage(role, html, streaming = false) {
  const messages = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = `message ${role}`;
  const avatarLabel = role === 'bot' ? 'STR' : (lang === 'sv' ? 'Du' : 'You');
  div.innerHTML = `
    <div class="avatar ${role}-avatar">${avatarLabel}</div>
    <div class="bubble" id="${streaming ? 'streamBubble' : ''}">${html.replace(/\n/g,'<br>')}</div>
  `;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
  return div.querySelector('.bubble');
}

function showTyping() {
  const messages = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = 'message bot'; div.id = 'typing';
  div.innerHTML = `<div class="avatar bot-avatar">STR</div><div class="bubble"><div class="dots"><span></span><span></span><span></span></div></div>`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function removeTyping() { const t = document.getElementById('typing'); if (t) t.remove(); }

function ask(btn) { document.getElementById('userInput').value = btn.textContent; sendMessage(); }

async function sendMessage() {
  if (isSending) return;
  const input = document.getElementById('userInput');
  const text = input.value.trim();
  if (!text) return;

  isSending = true;
  document.getElementById('sendBtn').disabled = true;
  document.getElementById('suggestions').style.display = 'none';
  addMessage('user', text);
  input.value = '';

  const faqAnswer = findFaqAnswer(text);

  try {
    if (aiOn) {
      // GROQ AI MODE
      showTyping();
      await new Promise(r => setTimeout(r, 100));
      removeTyping();

      // Create streaming bubble
      const messages = document.getElementById('messages');
      const div = document.createElement('div');
      div.className = 'message bot';
      div.innerHTML = `<div class="avatar bot-avatar">STR</div><div class="bubble" id="streamBubble"><span class="cursor"></span></div>`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;

      const streamEl = document.getElementById('streamBubble');
      const aiAnswer = await callGroq(text, streamEl);

      // Append web links if web mode also on
      if (webOn) {
        const webLabel = lang === 'sv' ? '<br><br>ğŸ” <strong>SÃ¶k Ã¤ven pÃ¥ webben:</strong><br>' : '<br><br>ğŸ” <strong>Also search the web:</strong><br>';
        streamEl.innerHTML += webLabel + buildWebLinks(text);
      }

    } else if (webOn) {
      // WEB ONLY MODE â€” show FAQ answer + web links
      showTyping();
      await new Promise(r => setTimeout(r, 400));
      removeTyping();
      const intro = lang === 'sv'
        ? (faqAnswer ? faqAnswer + '\n\nğŸ” <strong>SÃ¶k Ã¤ven pÃ¥ webben:</strong>' : 'ğŸ” SÃ¶k pÃ¥ webben fÃ¶r mer information:')
        : (faqAnswer ? faqAnswer + '\n\nğŸ” <strong>Also search the web:</strong>' : 'ğŸ” Search the web for more information:');
      addMessage('bot', intro + '<br>' + buildWebLinks(text));

    } else {
      // FAQ ONLY MODE
      showTyping();
      await new Promise(r => setTimeout(r, 500 + Math.random() * 300));
      removeTyping();
      addMessage('bot', faqAnswer || UI[lang].fallback);
    }
  } catch(e) {
    removeTyping();
    const errMsg = lang === 'sv'
      ? `âŒ AI-fel: ${e.message}\n\nFaller tillbaka till FAQ-svar...`
      : `âŒ AI error: ${e.message}\n\nFalling back to FAQ answer...`;
    addMessage('bot', errMsg);
    if (faqAnswer) setTimeout(() => addMessage('bot', faqAnswer), 800);
  }

  isSending = false;
  document.getElementById('sendBtn').disabled = false;
}

// â”€â”€ LANGUAGE & TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setLang(l, btn) {
  lang = l;
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('h-title').textContent = UI[lang].title;
  document.getElementById('h-sub').textContent = UI[lang].sub;
  document.getElementById('userInput').placeholder = UI[lang].placeholder;
  updateModes();
  renderTabs('all');
  renderSuggestions('all');
  document.getElementById('messages').innerHTML = '';
  addMessage('bot', UI[lang].welcome);
}

function renderTabs(activeCat) {
  const u = UI[lang];
  document.getElementById('tabs').innerHTML = u.tabs.map((t, i) =>
    `<button class="tab-btn ${u.tabKeys[i]===activeCat?'active':''}" onclick="setCategory('${u.tabKeys[i]}',this)">${t}</button>`
  ).join('');
}

function renderSuggestions(cat) {
  const qs = UI[lang].categories[cat] || UI[lang].categories.all;
  const sugg = document.getElementById('suggestions');
  sugg.style.display = 'flex';
  sugg.innerHTML = qs.map(q => `<button class="suggestion-btn" onclick="ask(this)">${q}</button>`).join('');
}

function setCategory(cat, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderSuggestions(cat);
}

function initApp() {
  renderTabs('all');
  renderSuggestions('all');
  updateModes();
  setTimeout(() => addMessage('bot', UI[lang].welcome), 300);
}

window.onload = () => {
  renderTabs('all');
  renderSuggestions('all');

  // Restore key from session if already entered this session
  const savedKey = sessionStorage.getItem('groqKey');
  const savedModel = sessionStorage.getItem('groqModel');
  if (savedKey && savedKey.startsWith('gsk_')) {
    groqKey = savedKey;
    groqModel = savedModel || 'llama-3.3-70b-versatile';
    document.getElementById('setupOverlay').classList.add('hidden');
    document.getElementById('modelBadge').textContent = groqModel.split('-').slice(0,2).join(' ');
    aiOn = true;
    updateModes();
    initApp();
  }
};
</script>
</body>
</html>
